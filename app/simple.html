<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Calendar App</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="root"></div>
    <canvas id="fireworks-canvas"></canvas>
    
    <script type="text/babel">
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ç®¡ç†
        const UserData = {
            saveUserSettings(data) {
                localStorage.setItem('calendarApp_userSettings', JSON.stringify(data));
            },
            
            getUserSettings() {
                const saved = localStorage.getItem('calendarApp_userSettings');
                return saved ? JSON.parse(saved) : null;
            },
            
            isSetupComplete() {
                const settings = this.getUserSettings();
                return settings && settings.name && settings.birthdate;
            },
            
            hasTodayFortuneShown() {
                const today = new Date().toDateString();
                const lastShown = localStorage.getItem('calendarApp_lastFortuneDate');
                return lastShown === today;
            },
            
            markTodayFortuneShown() {
                const today = new Date().toDateString();
                localStorage.setItem('calendarApp_lastFortuneDate', today);
            },
            
            isBirthday() {
                const settings = this.getUserSettings();
                if (!settings || !settings.birthdate) return false;
                
                const today = new Date();
                const birthdate = new Date(settings.birthdate);
                
                return today.getMonth() === birthdate.getMonth() && 
                       today.getDate() === birthdate.getDate();
            }
        };

        // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        const Helpers = {
            generateFortune(birthdate) {
                const fortunes = [
                    "ä»Šæ—¥ã¯æ–°ã—ã„ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã«æœ€é©ãªæ—¥ã§ã™ã€‚ç©æ¥µçš„ã«è¡Œå‹•ã—ã¾ã—ã‚‡ã†ï¼",
                    "äººã¨ã®å‡ºä¼šã„ãŒã‚ãªãŸã«è‰¯ã„å½±éŸ¿ã‚’ã‚‚ãŸã‚‰ã—ã¾ã™ã€‚",
                    "ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãªæ´»å‹•ã«åŠ›ã‚’æ³¨ãã¨è‰¯ã„çµæœãŒå¾—ã‚‰ã‚Œãã†ã§ã™ã€‚",
                    "å¥åº·ã«æ°—ã‚’ä»˜ã‘ãªãŒã‚‰ã€ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸä¸€æ—¥ã‚’éã”ã—ã¾ã—ã‚‡ã†ã€‚",
                    "ç›´æ„Ÿã‚’ä¿¡ã˜ã¦æ±ºæ–­ã™ã‚‹ã“ã¨ã§ã€å¹¸é‹ãŒèˆã„è¾¼ã¿ã¾ã™ã€‚",
                    "ä»Šæ—¥ã¯ã‚ãªãŸã®é­…åŠ›ãŒè¼ãæ—¥ã§ã™ã€‚è‡ªä¿¡ã‚’æŒã£ã¦éã”ã—ã¾ã—ã‚‡ã†ï¼",
                    "å‘¨ã‚Šã®äººã¸ã®æ€ã„ã‚„ã‚ŠãŒã€ã‚ãªãŸã«å¹¸ã›ã‚’é‹ã‚“ã§ãã‚Œã¾ã™ã€‚",
                    "ç¾ã—ã„ã‚‚ã®ã«è§¦ã‚Œã‚‹ã“ã¨ã§ã€å¿ƒãŒè±Šã‹ã«ãªã‚‹ä¸€æ—¥ã§ã™ã€‚",
                    "å®¶æ—ã‚„å‹äººã¨ã®æ™‚é–“ã‚’å¤§åˆ‡ã«ã™ã‚‹ã¨è‰¯ã„ã“ã¨ãŒã‚ã‚Šãã†ã§ã™ã€‚",
                    "æ–°ã—ã„è¶£å‘³ã‚„å­¦ã³ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã™ã‚‹ã¨é‹æ°—ãŒã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚"
                ];
                
                const randomIndex = Math.floor(Math.random() * fortunes.length);
                return fortunes[randomIndex];
            }
        };

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šç”»é¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        const UserSettings = ({ onComplete }) => {
            const [formData, setFormData] = React.useState({
                name: '',
                birthdate: ''
            });

            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: value
                }));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (!formData.name.trim() || !formData.birthdate) {
                    alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                UserData.saveUserSettings({
                    name: formData.name.trim(),
                    birthdate: formData.birthdate,
                    setupDate: new Date().toISOString()
                });

                onComplete();
            };

            return (
                <div className="settings-screen">
                    <div className="settings-form">
                        <h1 style={{ 
                            textAlign: 'center', 
                            marginBottom: '30px', 
                            color: '#333',
                            fontFamily: 'Baloo 2, cursive',
                            fontSize: '28px'
                        }}>ã¯ã˜ã‚ã¾ã—ã¦ï¼</h1>
                        
                        <p style={{ 
                            textAlign: 'center', 
                            marginBottom: '30px', 
                            color: '#666',
                            fontSize: '14px',
                            lineHeight: '1.6'
                        }}>ã‚ãªãŸã®æƒ…å ±ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚<br/>æ¯æ—¥ã®å ã„ã¨èª•ç”Ÿæ—¥ã®ãŠç¥ã„ã‚’ãŠå±Šã‘ã—ã¾ã™ï¼</p>

                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </label>
                                <input
                                    type="text"
                                    name="name"
                                    value={formData.name}
                                    onChange={handleChange}
                                    className="form-input"
                                    placeholder="ã‚ãªãŸã®ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                                />
                            </div>

                            <div className="form-group">
                                <label className="form-label">ç”Ÿå¹´æœˆæ—¥</label>
                                <input
                                    type="date"
                                    name="birthdate"
                                    value={formData.birthdate}
                                    onChange={handleChange}
                                    className="form-input"
                                />
                            </div>


                            <button type="submit" className="submit-button">
                                è¨­å®šå®Œäº†
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // å ã„ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        const FortuneModal = ({ name, fortune, onClose }) => {
            return (
                <div style={{
                    position: 'fixed',
                    top: 0,
                    left: 0,
                    width: '100%',
                    height: '100%',
                    background: 'rgba(0, 0, 0, 0.7)',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    zIndex: 10000,
                    padding: '20px'
                }} onClick={onClose}>
                    <div style={{
                        background: 'white',
                        borderRadius: '20px',
                        padding: '30px',
                        maxWidth: '400px',
                        width: '100%',
                        textAlign: 'center',
                        boxShadow: '0 20px 40px rgba(0, 0, 0, 0.3)'
                    }} onClick={(e) => e.stopPropagation()}>
                        <div style={{ fontSize: '48px', marginBottom: '20px' }}>ğŸ”®</div>
                        
                        <h2 style={{
                            fontFamily: 'Baloo 2, cursive',
                            fontSize: '24px',
                            marginBottom: '10px',
                            color: '#333'
                        }}>{name}ã•ã‚“ã®ä»Šæ—¥ã®é‹å‹¢</h2>
                        
                        <p style={{
                            fontSize: '16px',
                            lineHeight: '1.6',
                            color: '#666',
                            marginBottom: '30px'
                        }}>{fortune}</p>
                        
                        <button onClick={onClose} style={{
                            background: 'linear-gradient(45deg, #4A90E2, #357ABD)',
                            color: 'white',
                            border: 'none',
                            borderRadius: '10px',
                            padding: '12px 30px',
                            fontSize: '16px',
                            fontWeight: '600',
                            cursor: 'pointer'
                        }}>ã‚ã‚ŠãŒã¨ã†ï¼</button>
                    </div>
                </div>
            );
        };

        // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
        const App = () => {
            const [isSetupComplete, setIsSetupComplete] = React.useState(false);
            const [showFortune, setShowFortune] = React.useState(false);
            const [todayFortune, setTodayFortune] = React.useState('');
            const [loading, setLoading] = React.useState(true);

            React.useEffect(() => {
                const initializeApp = () => {
                    setLoading(true);
                    
                    const setupComplete = UserData.isSetupComplete();
                    setIsSetupComplete(setupComplete);
                    
                    if (setupComplete) {
                        if (!UserData.hasTodayFortuneShown()) {
                            const userSettings = UserData.getUserSettings();
                            const fortune = Helpers.generateFortune(userSettings.birthdate);
                            setTodayFortune(fortune);
                            setShowFortune(true);
                            UserData.markTodayFortuneShown();
                        }
                    }
                    
                    setLoading(false);
                };

                initializeApp();
            }, []);

            const handleSetupComplete = () => {
                setIsSetupComplete(true);
                
                const userSettings = UserData.getUserSettings();
                const fortune = Helpers.generateFortune(userSettings.birthdate);
                setTodayFortune(fortune);
                setShowFortune(true);
                UserData.markTodayFortuneShown();
            };

            const closeFortune = () => {
                setShowFortune(false);
            };

            if (loading) {
                return (
                    <div style={{
                        minHeight: '100vh',
                        background: 'linear-gradient(135deg, #4A90E2 0%, #357ABD 100%)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        color: 'white',
                        fontSize: '18px',
                        fontFamily: 'Baloo 2, cursive'
                    }}>Loading...</div>
                );
            }

            if (!isSetupComplete) {
                return <UserSettings onComplete={handleSetupComplete} />;
            }

            const userSettings = UserData.getUserSettings();
            
            return (
                <div>
                    {showFortune && (
                        <FortuneModal
                            name={userSettings.name}
                            fortune={todayFortune}
                            onClose={closeFortune}
                        />
                    )}
                    
                    <div style={{
                        minHeight: '100vh',
                        background: 'linear-gradient(135deg, #4A90E2 0%, #357ABD 100%)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        color: 'white',
                        padding: '20px',
                        textAlign: 'center'
                    }}>
                        <div>
                            <h1 style={{ marginBottom: '20px', fontFamily: 'Baloo 2, cursive' }}>
                                ã“ã‚“ã«ã¡ã¯ã€{userSettings.name}ã•ã‚“ï¼
                            </h1>
                            <p>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¢ãƒ—ãƒªãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚</p>
                            <button onClick={() => {
                                localStorage.clear();
                                window.location.reload();
                            }} style={{
                                marginTop: '20px',
                                padding: '10px 20px',
                                background: 'white',
                                color: '#4A90E2',
                                border: 'none',
                                borderRadius: '10px',
                                cursor: 'pointer'
                            }}>
                                è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆ
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
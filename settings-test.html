<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨­å®šãƒšãƒ¼ã‚¸ - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 30px;
        }
        
        .setting-section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 12px;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }
        
        .setting-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .setting-row:last-child {
            border-bottom: none;
        }
        
        .setting-info {
            flex-grow: 1;
        }
        
        .setting-title {
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
        }
        
        .setting-description {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }
        
        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #ccc;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .toggle-switch.active {
            background: #667eea;
        }
        
        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(30px);
        }
        
        .status-indicator {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .button:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }
        
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .button-secondary {
            background: #6c757d;
        }
        
        .button-secondary:hover {
            background: #5a6268;
        }
        
        .button-danger {
            background: #dc3545;
        }
        
        .button-danger:hover {
            background: #c82333;
        }
        
        .setting-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .alert-preview {
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        .alert-preview.show {
            display: block;
        }
        
        .preview-title {
            font-weight: 500;
            color: #2d3436;
            margin-bottom: 5px;
        }
        
        .preview-message {
            color: #636e72;
            font-size: 14px;
        }
        
        .test-results {
            background: #f1f3f4;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 12px;
            }
            
            .header, .content {
                padding: 20px;
            }
            
            .setting-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .toggle-switch {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš™ï¸ è¨­å®š</h1>
            <p>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¢ãƒ—ãƒªã®å„ç¨®è¨­å®šã‚’ç®¡ç†</p>
        </div>
        
        <div class="content">
            <!-- é€šçŸ¥è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="setting-section">
                <h3>ğŸ”” é€šçŸ¥è¨­å®š</h3>
                
                <div class="setting-row">
                    <div class="setting-info">
                        <div class="setting-title">ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½</div>
                        <div class="setting-description">äºˆå®šã®é€šçŸ¥ã‚’æœ‰åŠ¹ã«ã—ã¾ã™</div>
                    </div>
                    <div class="toggle-switch" id="alert-toggle" onclick="toggleAlerts()">
                        <div class="toggle-slider"></div>
                    </div>
                    <div id="alert-status" class="status-indicator status-warning">æœªè¨­å®š</div>
                </div>
                
                <div class="setting-row">
                    <div class="setting-info">
                        <div class="setting-title">éŸ³å£°é€šçŸ¥</div>
                        <div class="setting-description">ã‚¢ãƒ©ãƒ¼ãƒˆæ™‚ã«éŸ³ã‚’é³´ã‚‰ã—ã¾ã™</div>
                    </div>
                    <div class="toggle-switch" id="sound-toggle" onclick="toggleSound()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                
                <div class="setting-row" id="sound-options" style="display: none;">
                    <div class="setting-info">
                        <div class="setting-title">éŸ³å£°ã®ç¨®é¡</div>
                        <div class="setting-description">ä½¿ç”¨ã™ã‚‹éŸ³å£°ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
                    </div>
                    <select id="sound-type" onchange="updateSoundType()" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd; min-width: 120px;">
                        <option value="alarm1">ã‚¢ãƒ©ãƒ¼ãƒ 1</option>
                        <option value="alarm2">ã‚¢ãƒ©ãƒ¼ãƒ 2</option>
                        <option value="alarm3">ã‚¢ãƒ©ãƒ¼ãƒ 3</option>
                        <option value="alarm4">ã‚¢ãƒ©ãƒ¼ãƒ 4</option>
                    </select>
                    <button class="button btn-small" onclick="previewSound()" style="margin-left: 10px;">è©¦è´</button>
                </div>
                
                <div class="setting-row" id="volume-control" style="display: none;">
                    <div class="setting-info">
                        <div class="setting-title">éŸ³é‡</div>
                        <div class="setting-description">é€šçŸ¥éŸ³ã®éŸ³é‡ã‚’èª¿æ•´</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; min-width: 200px;">
                        <span style="font-size: 12px;">ğŸ”ˆ</span>
                        <input type="range" id="volume-slider" min="0" max="100" value="50" onchange="updateVolume()" style="flex-grow: 1;">
                        <span style="font-size: 12px;">ğŸ”Š</span>
                        <span id="volume-display" style="font-size: 12px; min-width: 30px;">50%</span>
                    </div>
                </div>
                
                <div class="setting-row">
                    <div class="setting-info">
                        <div class="setting-title">äº‹å‰é€šçŸ¥æ™‚é–“</div>
                        <div class="setting-description">äºˆå®šã®ä½•åˆ†å‰ã«é€šçŸ¥ã™ã‚‹ã‹</div>
                    </div>
                    <select id="notification-time" onchange="updateNotificationTime()" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                        <option value="0">å½“æ—¥</option>
                        <option value="5">5åˆ†å‰</option>
                        <option value="10">10åˆ†å‰</option>
                        <option value="15">15åˆ†å‰</option>
                        <option value="30">30åˆ†å‰</option>
                        <option value="60">1æ™‚é–“å‰</option>
                    </select>
                </div>
                
                <div class="setting-actions">
                    <button class="button" onclick="requestNotificationPermission()">
                        é€šçŸ¥è¨±å¯ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                    </button>
                    <button class="button button-secondary" onclick="testNotification()">
                        ãƒ†ã‚¹ãƒˆé€šçŸ¥
                    </button>
                </div>
                
                <div id="alert-preview" class="alert-preview">
                    <div class="preview-title">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼: ä¼šè­°ã®æ™‚é–“ã§ã™</div>
                    <div class="preview-message">15åˆ†å¾Œã«ä¼šè­°ãŒå§‹ã¾ã‚Šã¾ã™ã€‚æº–å‚™ã‚’ãŠå¿˜ã‚Œãªãï¼</div>
                </div>
            </div>
            
            <!-- è¡¨ç¤ºè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="setting-section">
                <h3>ğŸ¨ è¡¨ç¤ºè¨­å®š</h3>
                
                <div class="setting-row">
                    <div class="setting-info">
                        <div class="setting-title">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</div>
                        <div class="setting-description">æš—ã„ãƒ†ãƒ¼ãƒã‚’ä½¿ç”¨ã—ã¾ã™</div>
                    </div>
                    <div class="toggle-switch" id="dark-mode-toggle" onclick="toggleDarkMode()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                
                <div class="setting-row">
                    <div class="setting-info">
                        <div class="setting-title">é€±ã®é–‹å§‹æ—¥</div>
                        <div class="setting-description">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®é€±ã®é–‹å§‹æ—¥ã‚’è¨­å®š</div>
                    </div>
                    <select id="week-start" onchange="updateWeekStart()" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
                        <option value="0">æ—¥æ›œæ—¥</option>
                        <option value="1">æœˆæ›œæ—¥</option>
                    </select>
                </div>
            </div>
            
            <!-- ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="setting-section">
                <h3>ğŸ”§ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h3>
                
                <div class="setting-row">
                    <div class="setting-info">
                        <div class="setting-title">è‡ªå‹•ä¿å­˜</div>
                        <div class="setting-description">å¤‰æ›´ã‚’è‡ªå‹•çš„ã«ä¿å­˜ã—ã¾ã™</div>
                    </div>
                    <div class="toggle-switch active" id="auto-save-toggle" onclick="toggleAutoSave()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                
                <div class="setting-actions">
                    <button class="button" onclick="exportSettings()">
                        è¨­å®šã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                    </button>
                    <button class="button button-secondary" onclick="importSettings()">
                        è¨­å®šã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                    </button>
                    <button class="button button-danger" onclick="resetSettings()">
                        è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆ
                    </button>
                </div>
            </div>
            
            <!-- ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤º -->
            <div class="setting-section">
                <h3>ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°</h3>
                <div class="setting-actions">
                    <button class="button" onclick="runSystemCheck()">
                        ã‚·ã‚¹ãƒ†ãƒ ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
                    </button>
                    <button class="button button-secondary" onclick="clearTestResults()">
                        ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢
                    </button>
                </div>
                <div id="test-results" class="test-results"></div>
            </div>
        </div>
    </div>
    
    <script>
        // è¨­å®šç®¡ç†ã‚¯ãƒ©ã‚¹
        class SettingsManager {
            constructor() {
                this.settings = this.loadSettings();
                this.init();
            }
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
            getDefaultSettings() {
                return {
                    alerts: {
                        enabled: false,
                        sound: true,
                        soundType: 'alarm1',
                        volume: 50,
                        notificationTime: 15
                    },
                    display: {
                        darkMode: false,
                        weekStart: 0
                    },
                    system: {
                        autoSave: true
                    }
                };
            }
            
            // è¨­å®šã®èª­ã¿è¾¼ã¿
            loadSettings() {
                try {
                    const saved = localStorage.getItem('calendar-settings');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        return { ...this.getDefaultSettings(), ...parsed };
                    }
                } catch (error) {
                    this.log('è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
                return this.getDefaultSettings();
            }
            
            // è¨­å®šã®ä¿å­˜
            saveSettings() {
                try {
                    localStorage.setItem('calendar-settings', JSON.stringify(this.settings));
                    this.log('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                    return true;
                } catch (error) {
                    this.log('è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                    return false;
                }
            }
            
            // åˆæœŸåŒ–
            init() {
                this.updateUI();
                this.checkNotificationPermission();
                this.log('è¨­å®šãƒšãƒ¼ã‚¸ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ');
            }
            
            // UIã®æ›´æ–°
            updateUI() {
                // ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š
                this.setToggleState('alert-toggle', this.settings.alerts.enabled);
                this.setToggleState('sound-toggle', this.settings.alerts.sound);
                document.getElementById('notification-time').value = this.settings.alerts.notificationTime;
                document.getElementById('sound-type').value = this.settings.alerts.soundType;
                document.getElementById('volume-slider').value = this.settings.alerts.volume;
                document.getElementById('volume-display').textContent = this.settings.alerts.volume + '%';
                this.updateSoundOptions();
                
                // è¡¨ç¤ºè¨­å®š
                this.setToggleState('dark-mode-toggle', this.settings.display.darkMode);
                document.getElementById('week-start').value = this.settings.display.weekStart;
                
                // ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
                this.setToggleState('auto-save-toggle', this.settings.system.autoSave);
                
                this.updateAlertStatus();
            }
            
            // ãƒˆã‚°ãƒ«ã‚¹ã‚¤ãƒƒãƒã®çŠ¶æ…‹è¨­å®š
            setToggleState(elementId, active) {
                const toggle = document.getElementById(elementId);
                if (toggle) {
                    if (active) {
                        toggle.classList.add('active');
                    } else {
                        toggle.classList.remove('active');
                    }
                }
            }
            
            // ã‚¢ãƒ©ãƒ¼ãƒˆçŠ¶æ…‹ã®æ›´æ–°
            updateAlertStatus() {
                const status = document.getElementById('alert-status');
                if (!status) return;
                
                if (!this.settings.alerts.enabled) {
                    status.className = 'status-indicator status-warning';
                    status.textContent = 'ç„¡åŠ¹';
                } else if (Notification.permission === 'granted') {
                    status.className = 'status-indicator status-success';
                    status.textContent = 'æœ‰åŠ¹';
                } else {
                    status.className = 'status-indicator status-error';
                    status.textContent = 'è¨±å¯å¿…è¦';
                }
            }
            
            // é€šçŸ¥è¨±å¯ã®ç¢ºèª
            async checkNotificationPermission() {
                if ('Notification' in window) {
                    this.updateAlertStatus();
                } else {
                    this.log('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯é€šçŸ¥ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“');
                }
            }
            
            // éŸ³å£°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º/éè¡¨ç¤º
            updateSoundOptions() {
                const soundOptions = document.getElementById('sound-options');
                const volumeControl = document.getElementById('volume-control');
                
                if (this.settings.alerts.sound) {
                    soundOptions.style.display = 'flex';
                    volumeControl.style.display = 'flex';
                } else {
                    soundOptions.style.display = 'none';
                    volumeControl.style.display = 'none';
                }
            }
            
            // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒãƒ”ãƒ³ã‚°
            getAudioFilePath(alarmType) {
                const audioFiles = {
                    'alarm1': 'Sound/æ±ºå®š10.mp3',
                    'alarm2': 'Sound/æ±ºå®š16.mp3',
                    'alarm3': 'Sound/æ±ºå®š2.mp3',
                    'alarm4': 'Sound/é¸æŠ1.mp3'
                };
                return audioFiles[alarmType];
            }
            
            // éŸ³å£°å†ç”Ÿæ©Ÿèƒ½
            async playSound(type = null, volume = null) {
                const soundType = type || this.settings.alerts.soundType;
                const soundVolume = (volume !== null ? volume : this.settings.alerts.volume) / 100;
                
                try {
                    switch (soundType) {
                        case 'alarm1':
                        case 'alarm2':
                        case 'alarm3':
                        case 'alarm4':
                            await this.playAudioFile(soundVolume, soundType);
                            break;
                        default:
                            await this.playAudioFile(soundVolume, 'alarm1');
                    }
                } catch (error) {
                    this.log('éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼: ' + error.message);
                }
            }
            
            
            // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®å†ç”Ÿ
            async playAudioFile(volume, alarmType) {
                try {
                    const baseFileName = this.getAudioFilePath(alarmType);
                    
                    // è¤‡æ•°ã®ãƒ‘ã‚¹ã‚’è©¦ã™
                    const possiblePaths = [
                        baseFileName,
                        `./${baseFileName}`,
                        `../${baseFileName}`,
                        `/ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¢ãƒ—ãƒª/${baseFileName}`
                    ];
                    
                    let audio = null;
                    let loadedPath = null;
                    
                    for (const path of possiblePaths) {
                        try {
                            audio = new Audio(path);
                            audio.volume = volume;
                            
                            // ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ãƒ†ã‚¹ãƒˆ
                            await new Promise((resolve, reject) => {
                                const timeoutId = setTimeout(() => reject(new Error('ãƒ­ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ')), 3000);
                                
                                audio.addEventListener('canplay', () => {
                                    clearTimeout(timeoutId);
                                    resolve();
                                }, { once: true });
                                
                                audio.addEventListener('error', () => {
                                    clearTimeout(timeoutId);
                                    reject(new Error('ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼'));
                                }, { once: true });
                                
                                audio.load();
                            });
                            
                            loadedPath = path;
                            this.log(`éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿æˆåŠŸ: ${path}`);
                            break;
                        } catch (error) {
                            this.log(`éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å¤±æ•—: ${path} - ${error.message}`);
                            continue;
                        }
                    }
                    
                    if (audio && loadedPath) {
                        await audio.play();
                        this.log(`${alarmType}å†ç”Ÿ: ${loadedPath}`);
                    } else {
                        throw new Error(`éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${alarmType}`);
                    }
                } catch (error) {
                    this.log(`éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
            
            
            // è¨­å®šå€¤ã®æ›´æ–°
            updateSetting(path, value) {
                const keys = path.split('.');
                let current = this.settings;
                
                for (let i = 0; i < keys.length - 1; i++) {
                    if (!current[keys[i]]) {
                        current[keys[i]] = {};
                    }
                    current = current[keys[i]];
                }
                
                current[keys[keys.length - 1]] = value;
                
                if (this.settings.system.autoSave) {
                    this.saveSettings();
                }
                
                this.log(`è¨­å®šæ›´æ–°: ${path} = ${value}`);
            }
            
            // ãƒ­ã‚°å‡ºåŠ›
            log(message) {
                const results = document.getElementById('test-results');
                if (results) {
                    const timestamp = new Date().toLocaleTimeString();
                    results.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                    results.scrollTop = results.scrollHeight;
                }
            }
            
            // è¨­å®šã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
            exportSettings() {
                try {
                    const data = JSON.stringify(this.settings, null, 2);
                    const blob = new Blob([data], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `calendar-settings-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    
                    URL.revokeObjectURL(url);
                    this.log('è¨­å®šã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
                } catch (error) {
                    this.log('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            }
            
            // è¨­å®šã®ãƒªã‚»ãƒƒãƒˆ
            resetSettings() {
                if (confirm('ã™ã¹ã¦ã®è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                    this.settings = this.getDefaultSettings();
                    this.saveSettings();
                    this.updateUI();
                    this.log('è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
                }
            }
        }
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        let settingsManager;
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
        function toggleAlerts() {
            const enabled = !settingsManager.settings.alerts.enabled;
            settingsManager.updateSetting('alerts.enabled', enabled);
            settingsManager.setToggleState('alert-toggle', enabled);
            settingsManager.updateAlertStatus();
            
            if (enabled) {
                document.getElementById('alert-preview').classList.add('show');
            } else {
                document.getElementById('alert-preview').classList.remove('show');
            }
        }
        
        function toggleSound() {
            const enabled = !settingsManager.settings.alerts.sound;
            settingsManager.updateSetting('alerts.sound', enabled);
            settingsManager.setToggleState('sound-toggle', enabled);
            settingsManager.updateSoundOptions();
        }
        
        function updateSoundType() {
            const type = document.getElementById('sound-type').value;
            settingsManager.updateSetting('alerts.soundType', type);
        }
        
        function updateVolume() {
            const volume = parseInt(document.getElementById('volume-slider').value);
            settingsManager.updateSetting('alerts.volume', volume);
            document.getElementById('volume-display').textContent = volume + '%';
        }
        
        function previewSound() {
            settingsManager.playSound();
        }
        
        function toggleDarkMode() {
            const enabled = !settingsManager.settings.display.darkMode;
            settingsManager.updateSetting('display.darkMode', enabled);
            settingsManager.setToggleState('dark-mode-toggle', enabled);
            // TODO: ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã®é©ç”¨
        }
        
        function toggleAutoSave() {
            const enabled = !settingsManager.settings.system.autoSave;
            settingsManager.updateSetting('system.autoSave', enabled);
            settingsManager.setToggleState('auto-save-toggle', enabled);
        }
        
        function updateNotificationTime() {
            const time = parseInt(document.getElementById('notification-time').value);
            settingsManager.updateSetting('alerts.notificationTime', time);
        }
        
        function updateWeekStart() {
            const start = parseInt(document.getElementById('week-start').value);
            settingsManager.updateSetting('display.weekStart', start);
        }
        
        async function requestNotificationPermission() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                settingsManager.updateAlertStatus();
                settingsManager.log(`é€šçŸ¥è¨±å¯ã®çµæœ: ${permission}`);
            } else {
                settingsManager.log('é€šçŸ¥ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
            }
        }
        
        function testNotification() {
            if (Notification.permission === 'granted') {
                const notification = new Notification('ãƒ†ã‚¹ãƒˆé€šçŸ¥', {
                    body: 'ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ï¼',
                    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMzIiIGZpbGw9IiM2NjdlZWEiLz4KPHN2ZyB4PSIxNiIgeT0iMTYiIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAyMmMyIDAgNC0xIDQtM0g4YzAgMiAyIDMgNCAzem0tNi0zaDEyVjE3TDYgMTZ2M3ptMC03djRsNCAuNjJWMTZjMC01LjUgMy02IDMtNiAwIDMgMiAzIDMgM3YtNGMwLTQtMy0xMC04LTEwLTQgMC04IDUtOCAxMCAwLTItMi00LTItN3YtMWMwLTEuNSAxLTMgMi41LTNzMi41IDEuNSAyLjUgM3YxeiIvPgo8L3N2Zz4KPC9zdmc+'
                });
                
                if (settingsManager.settings.alerts.sound) {
                    settingsManager.playSound();
                }
                
                settingsManager.log('ãƒ†ã‚¹ãƒˆé€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã—ãŸ');
                
                setTimeout(() => {
                    notification.close();
                }, 5000);
            } else {
                settingsManager.log('é€šçŸ¥è¨±å¯ãŒå¿…è¦ã§ã™');
            }
        }
        
        function exportSettings() {
            settingsManager.exportSettings();
        }
        
        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const imported = JSON.parse(e.target.result);
                            settingsManager.settings = { ...settingsManager.getDefaultSettings(), ...imported };
                            settingsManager.saveSettings();
                            settingsManager.updateUI();
                            settingsManager.log('è¨­å®šã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
                        } catch (error) {
                            settingsManager.log('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        function resetSettings() {
            settingsManager.resetSettings();
        }
        
        function runSystemCheck() {
            settingsManager.log('=== ã‚·ã‚¹ãƒ†ãƒ ãƒã‚§ãƒƒã‚¯é–‹å§‹ ===');
            
            // é€šçŸ¥ã‚µãƒãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯
            if ('Notification' in window) {
                settingsManager.log('âœ… é€šçŸ¥API ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿');
                settingsManager.log(`é€šçŸ¥è¨±å¯çŠ¶æ…‹: ${Notification.permission}`);
            } else {
                settingsManager.log('âŒ é€šçŸ¥API æœªã‚µãƒãƒ¼ãƒˆ');
            }
            
            // éŸ³å£°é–¢é€£ã®ãƒã‚§ãƒƒã‚¯
            settingsManager.log('ğŸ”Š éŸ³å£°ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            setTimeout(() => {
                settingsManager.playSound('alarm1', 50);
            }, 1000);
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãƒã‚§ãƒƒã‚¯
            settingsManager.log('â„¹ï¸ éŸ³ãŒèã“ãˆãªã„å ´åˆ:');
            settingsManager.log('  1. ãƒ–ãƒ©ã‚¦ã‚¶ã®éŸ³é‡ã‚’ç¢ºèª');
            settingsManager.log('  2. ã‚·ã‚¹ãƒ†ãƒ ã®éŸ³é‡ã‚’ç¢ºèª');
            settingsManager.log('  3. ä»–ã®ã‚¿ãƒ–ã§ã®éŸ³å£°ã‚’ç¢ºèª');
            settingsManager.log('  4. "è©¦è´"ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆ');
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒã‚§ãƒƒã‚¯
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                settingsManager.log('âœ… ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ åˆ©ç”¨å¯èƒ½');
            } catch (error) {
                settingsManager.log('âŒ ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
            
            
            // è¨­å®šãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
            const requiredSettings = ['alerts', 'display', 'system'];
            let valid = true;
            for (const key of requiredSettings) {
                if (!settingsManager.settings[key]) {
                    settingsManager.log(`âŒ è¨­å®šãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆ: ${key} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                    valid = false;
                }
            }
            if (valid) {
                settingsManager.log('âœ… è¨­å®šãƒ‡ãƒ¼ã‚¿ æ•´åˆæ€§OK');
            }
            
            settingsManager.log('=== ã‚·ã‚¹ãƒ†ãƒ ãƒã‚§ãƒƒã‚¯å®Œäº† ===');
        }
        
        function clearTestResults() {
            document.getElementById('test-results').innerHTML = '';
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            settingsManager = new SettingsManager();
        });
    </script>
</body>
</html>